var E=Object.defineProperty;var I=(i,e,t)=>e in i?E(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var n=(i,e,t)=>I(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function g(i,e){return e==="admin"?i==="admin":e==="user"?i==="user"||i==="admin":!0}class f{constructor(e,t,r){n(this,"_name","name");n(this,"_parent");n(this,"_children");n(this,"_files");n(this,"_accessAuthorityLevel","guest");this._name=e,t&&(this.accessAuthorityLevel=t),this._parent=r}withFiles(e){return this.files=[...e],this}withChildrenFolder(e){return this.children=e,this}withChildFolder(e){return this.children||(this.children=[]),e.parent=this,this.children.push(e),this}get fullPathName(){const e=[];let t=this;for(;t;)e.unshift(t.name),t=t.parent;return e.join("/")}get name(){return this._name}set name(e){this._name=e}get parent(){return this._parent}set parent(e){this._parent=e}get children(){return this._children}set children(e){var t;e&&(this._children=[...e],(t=this._children)==null||t.forEach(r=>r.parent=this))}get files(){return this._files}set files(e){this._files=e}get accessAuthorityLevel(){return this._accessAuthorityLevel}set accessAuthorityLevel(e){this._accessAuthorityLevel=e}}const v=Object.freeze(Object.defineProperty({__proto__:null,Folder:f},Symbol.toStringTag,{value:"Module"}));class y{constructor(e,t,r,s){n(this,"_name","computer");n(this,"_addressIp","0.0.0.0");n(this,"_mainFolder",new f("home"));n(this,"_authority","admin");n(this,"_password","");n(this,"_passwordAuthUser","");n(this,"_passwordAuthAdmin","");n(this,"_computersLinked",[]);this.addressIp=e,this.name=t,r&&(this.password=r),s&&(this.authority=s)}withMainFolder(e){return this.mainFolder=e,this}withComputersLinked(e){return this.computersLinked=e,this}withComputerLinked(e){return this._computersLinked.find(t=>t.addressIp===e.addressIp&&t.name===e.name)||(this._computersLinked.push(e),e.computersLinked.find(t=>t.addressIp===this.addressIp&&t.name===this.name)||e._computersLinked.push(this)),this}withPasswordAuthUser(e){return this.passwordAuthUser=e,this}withPasswordAuthAdmin(e){return this.passwordAuthAdmin=e,this}get name(){return this._name}set name(e){this._name=e}get addressIp(){return this._addressIp}set addressIp(e){if(!/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e))throw new Error("Invalid IP address format");this._addressIp=e}get mainFolder(){return this._mainFolder}set mainFolder(e){this._mainFolder=e}get authority(){return this._authority}set authority(e){this._authority=e}get computersLinked(){return this._computersLinked}set computersLinked(e){e.forEach(t=>{t.computersLinked.find(r=>r.addressIp===t.addressIp&&r.name===t.name)||t.computersLinked.push(this)}),this._computersLinked=[...e]}get password(){return this._password}set password(e){this._password=e}get passwordAuthUser(){return this._passwordAuthUser}set passwordAuthUser(e){this._passwordAuthUser=e}get passwordAuthAdmin(){return this._passwordAuthAdmin}set passwordAuthAdmin(e){this._passwordAuthAdmin=e}}class w{constructor(e,t,r){n(this,"_name","name.txt");n(this,"_content","");n(this,"_accessAuthorityLevel","guest");this.name=e,this.content=t,r&&(this.accessAuthorityLevel=r)}get name(){return this._name}set name(e){this._name=e}get content(){return this._content}set content(e){this._content=e}get accessAuthorityLevel(){return this._accessAuthorityLevel}set accessAuthorityLevel(e){this._accessAuthorityLevel=e}}const P=Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"})),b=async(i,e)=>{const t=i[0],r=i[1];if(!["admin","user","guest"].includes(t)){e.ui.writeLine("Error command, usage: changeAuth <admin | user | guest> <?password>");return}const s=e.fs.getCurrentComputer(),o=s.authority,a=u=>{s.authority=u,e.ui.updatePrompt(e.getPromptToUpdate(),e.network.isCurrentlyConnected(),u),e.ui.writeLine(`you are now connected as ${u}`)},d=(u,h)=>h===""||r&&h===r?(a(u),!0):(e.ui.writeLine("Error wrong password, usage: changeAuth <admin | user | guest> <?password>"),!1),c=t;if(o==="admin"){a(c);return}switch(c){case"admin":d("admin",s.passwordAuthAdmin);break;case"user":o==="user"?e.ui.writeLine("you are now connected as user"):d("user",s.passwordAuthUser);break;case"guest":o==="guest"?e.ui.writeLine("you are now connected as guest"):a("guest");break}},U=async(i,e)=>{e.ui.writeLine("Commandes: help, ls, cat, pwd, cd, echo, scan, connect, disconnect, rm, changeAuth, run, mem, clear, whoami, save, load, reset"),e.ui.writeLine("Ex: ls, cat readme.txt, cd /home, scan, connect <1.2.0.7> <name> <?password>, changeAuth <admin | user | guest> <?password>, run tracer, save/load fs (IndexedDB)")},$=async(i,e)=>{const t=e.fs.getCurrentFolder(),r=[];t.files&&r.push(...t.files.filter(s=>g(e.fs.getCurrentComputer().authority,s.accessAuthorityLevel)).map(s=>s.name)),t.children&&r.push(...t.children.filter(s=>g(e.fs.getCurrentComputer().authority,s.accessAuthorityLevel)).map(s=>s.name)),e.ui.writeLine(r.join("  ")||"")},M=async(i,e)=>e.ui.writeLine(e.fs.getCurrentFolder().fullPathName),T=async(i,e)=>{var o;const t=i[0];if(!t)return e.ui.writeLine("Usage: cd <folder> or ../");const r=e.fs.getCurrentFolder();if(t==="../"){if(r.parent){e.fs.setCurrentFolder(r.parent),e.ui.writeLine("currentFolder : "+r.parent.name),e.ui.updatePrompt(e.getPromptToUpdate(),e.network.isCurrentlyConnected(),e.fs.getCurrentComputer().authority);return}e.ui.writeLine("error : no parent folder.");return}const s=(o=r.children)==null?void 0:o.find(a=>a.name===t);if(s&&g(e.fs.getCurrentComputer().authority,s.accessAuthorityLevel)){e.fs.setCurrentFolder(s),e.ui.writeLine("currentFolder : "+s.name),e.ui.updatePrompt(e.getPromptToUpdate(),e.network.isCurrentlyConnected(),e.fs.getCurrentComputer().authority);return}e.ui.writeLine('error : folder does not exist with name "'+t+'"')},S=async(i,e)=>{var s;const t=i[0];if(!t)return e.ui.writeLine("Usage: cat <file>");const r=e.fs.getCurrentFolder();if(r.files&&r.files.length>0){const o=(s=r.files)==null?void 0:s.find(a=>a.name===t);if(o&&g(e.fs.getCurrentComputer().authority,o.accessAuthorityLevel)){e.ui.writeLine(o.content);return}}e.ui.writeLine('error : file does not exist with name "'+t+'"')},B=async(i,e)=>e.ui.writeLine(i.join(" ")),O=async(i,e)=>e.ui.writeLine(e.fs.getCurrentComputer().authority),D=async(i,e)=>{e.ui.clearOutput()},j=async(i,e)=>{const t=e.memory.getMemory();e.ui.writeLine(`Memory: ${t.used}/${t.total} Mo used`)},N=async(i,e)=>{e.ui.writeLine("Scanning network...");const t=e.fs.getCurrentComputer().computersLinked;t.length===0&&(await e.delay(500),e.ui.writeLine("none"));for(const r of t)await e.delay(Math.random()*500+250),e.ui.writeLine(`${r.addressIp}	${r.name}`);e.ui.writeLine("Scanning network completed")},R="modulepreload",H=function(i){return"/my-vanilla-ts-vite-app/"+i},A={},_=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let a=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),c=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));s=a(t.map(u=>{if(u=H(u),u in A)return;A[u]=!0;const h=u.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const l=document.createElement("link");if(l.rel=h?"stylesheet":R,h||(l.as="script"),l.crossOrigin="",l.href=u,c&&l.setAttribute("nonce",c),document.head.appendChild(l),h)return new Promise((C,L)=>{l.addEventListener("load",C),l.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a}return s.then(a=>{for(const d of a||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},q=async(i,e)=>{var l,C,L;const t=i[0],r=i[1],s=i[2]?i[2]:"";if(!t||!r)return e.ui.writeLine("Usage: connect <ip> <name> <?password>");e.ui.writeLine(`try to connect to ${i} ...`),await e.delay(500);const o=e.fs.getCurrentComputer().addressIp,a=e.fs.getCurrentComputer().computersLinked.find(m=>m.addressIp===t&&m.name===r&&(m.password?m.password===s:!0));if(!a){e.ui.writeLine(`connexion to ${i} failed, please check ip and name by using scan or maybe you have wrong password `);return}let d=(l=a.mainFolder.children)==null?void 0:l.find(m=>m.name==="var");d||(d=new(await _(async()=>{const{Folder:m}=await Promise.resolve().then(()=>v);return{Folder:m}},void 0)).Folder("var","admin"),a.mainFolder.withChildFolder(d));let c=(C=d.children)==null?void 0:C.find(m=>m.name==="log");c||(c=new(await _(async()=>{const{Folder:m}=await Promise.resolve().then(()=>v);return{Folder:m}},void 0)).Folder("log","admin"),d.withChildFolder(c));let u=(L=c.files)==null?void 0:L.find(m=>m.name==="connections.log");u||(u=new(await _(async()=>{const{default:m}=await Promise.resolve().then(()=>P);return{default:m}},void 0)).default("connections.log",`[LOGS STARTED]
`,"user"),c.files||(c.files=[]),c.files.push(u));const p=`
[${new Date().toISOString()}] Connection received from ${o}`;u.content+=p,e.network.isConnected=!0,e.fs.setCurrentComputer(a),e.fs.getCurrentComputer().authority="guest",e.ui.updatePrompt(e.getPromptToUpdate(),e.network.isCurrentlyConnected(),e.fs.getCurrentComputer().authority),e.ui.updateConnectionBadge(!0),e.ui.writeLine(`connexion succeed, you are now connected to ${e.fs.getCurrentComputer().addressIp} ${e.fs.getCurrentComputer().name} => ${e.fs.getCurrentFolder().name}`)},G=async(i,e)=>{e.ui.writeLine("disconnecting..."),await e.delay(Math.random()*1e3+500),e.network.isConnected=!1,e.fs.setCurrentComputer(e.fs.getOwnerComputer()),e.fs.getCurrentComputer().authority="admin",e.ui.updatePrompt(e.getPromptToUpdate(),e.network.isCurrentlyConnected(),e.fs.getCurrentComputer().authority),e.ui.updateConnectionBadge(!1),e.ui.writeLine(`disconnect succeed, you are now back to ${e.fs.getCurrentComputer().addressIp} ${e.fs.getCurrentComputer().name} => ${e.fs.getCurrentFolder().name}`)},V=async(i,e)=>{const t=i[0]??"ping",r=t==="tracer"?256:128;if(!e.memory.allocate(r))return e.ui.writeLine(`run: mémoire insuffisante pour ${t} (besoin ${r} Mo)`);e.ui.writeLine(`Lancement de ${t}... (consomme ${r} Mo)`),e.ui.updateMemoryUI(e.memory.getMemory()),await e.delay(1500+Math.random()*2500),e.ui.writeLine(`${t}: terminé.`),e.memory.free(r),e.ui.updateMemoryUI(e.memory.getMemory())},z=async(i,e)=>{var d,c;const t=i[0];if(!t)return e.ui.writeLine("Usage: rm <file_or_folder>");const r=e.fs.getCurrentFolder(),s=e.fs.getCurrentComputer().authority,o=((d=r.files)==null?void 0:d.findIndex(u=>u.name===t))??-1;if(o!==-1&&r.files){const u=r.files[o];g(s,u.accessAuthorityLevel)?(r.files.splice(o,1),e.ui.writeLine(`File '${t}' deleted.`)):e.ui.writeLine(`rm: permission denied to delete file '${t}'.`);return}const a=((c=r.children)==null?void 0:c.findIndex(u=>u.name===t))??-1;if(a!==-1&&r.children){const u=r.children[a];g(s,u.accessAuthorityLevel)?!u.children||u.children.length===0?(r.children.splice(a,1),e.ui.writeLine(`Folder '${t}' and its files have been deleted.`)):e.ui.writeLine(`rm: failed to remove '${t}': Directory contains other directories.`):e.ui.writeLine(`rm: permission denied to delete folder '${t}'.`);return}e.ui.writeLine(`rm: cannot remove '${t}': No such file or directory.`)},W=async(i,e)=>{e.ui.writeLine("work in progress...")},K=async(i,e)=>{e.ui.writeLine("work in progress...")},X=async(i,e)=>{e.memory.reset(),e.ui.updateMemoryUI(e.memory.getMemory()),await e.db.delete("fs"),await e.db.delete("memory"),e.ui.writeLine("Reset: FS remis par défaut et IndexedDB nettoyée.")},F={changeAuth:b,help:U,ls:$,pwd:M,cd:T,cat:S,echo:B,whoami:O,clear:D,mem:j,scan:N,connect:q,disconnect:G,run:V,rm:z,save:W,load:K,reset:X},k=512;class Z{async openDB(){return new Promise((e,t)=>{const r=indexedDB.open("HacknetProtoDB",1);r.onupgradeneeded=()=>{const s=r.result;s.objectStoreNames.contains("kv")||s.createObjectStore("kv")},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}async put(e,t){const r=await this.openDB();return new Promise((s,o)=>{const a=r.transaction("kv","readwrite");a.objectStore("kv").put(t,e),a.oncomplete=()=>s(),a.onerror=()=>o(a.error)})}async get(e){const t=await this.openDB();return new Promise((r,s)=>{const a=t.transaction("kv","readonly").objectStore("kv").get(e);a.onsuccess=()=>r(a.result??null),a.onerror=()=>s(a.error)})}async delete(e){const t=await this.openDB();return new Promise((r,s)=>{const o=t.transaction("kv","readwrite");o.objectStore("kv").delete(e),o.oncomplete=()=>r(),o.onerror=()=>s(o.error)})}}class J{constructor(){n(this,"ownerComputer");n(this,"currentComputer");n(this,"currentFolder");n(this,"getOwnerComputer",()=>this.ownerComputer);n(this,"setOwnerComputer",e=>{this.ownerComputer=e});n(this,"getCurrentComputer",()=>this.currentComputer);n(this,"setCurrentComputer",e=>{this.currentComputer=e,this.currentFolder=e.mainFolder});n(this,"getCurrentFolder",()=>this.currentFolder);n(this,"setCurrentFolder",e=>{this.currentFolder=e});this.ownerComputer=new y("192.168.0.42","wax","wax").withPasswordAuthUser("user").withPasswordAuthAdmin("admin").withMainFolder(new f("main").withFiles([new w("f1admin.txt","le contenu du fichier admin","admin"),new w("f1user.txt","le contenu du fichier user","user"),new w("f1guest.txt","le contenu du fichier guest","guest")]).withChildrenFolder([new f("intro").withFiles([new w("readme.txt","un nouveau contenu"),new w("secret.txt","code Bob => bob","admin")]),new f("folderAdmin","admin"),new f("folderUser","user"),new f("folderGuest","guest")])).withComputersLinked([new y("192.168.2.1","Bob","bob"),new y("192.168.0.254","Fry"),new y("192.168.14.9","Mey"),new y("193.169.1.11","Dan")]),this.currentComputer=this.ownerComputer,this.currentFolder=this.currentComputer.mainFolder}}class Q{constructor(){n(this,"memory");n(this,"getMemory",()=>this.memory);n(this,"setMemory",e=>{this.memory=e});n(this,"allocate",e=>this.memory.used+e>this.memory.total?!1:(this.memory.used+=e,!0));n(this,"free",e=>{this.memory.used=Math.max(0,this.memory.used-e)});n(this,"reset",()=>{this.memory={total:k,used:0}});this.memory={total:k,used:0}}}class Y{constructor(){n(this,"output");n(this,"cwdEl");n(this,"memUsedEl");n(this,"memTotEl");n(this,"connBadge");n(this,"writeLine",(e,t)=>{const r=document.createElement("div");r.className="line"+(t?" "+t:""),r.textContent=e,this.output.appendChild(r),this.output.scrollTop=this.output.scrollHeight});n(this,"writePromptLine",e=>{const t=document.createElement("div");t.className="line",t.innerHTML=`<span class="prompt">> </span>${this.escapeHtml(e)}`,this.output.appendChild(t),this.output.scrollTop=this.output.scrollHeight});n(this,"clearOutput",()=>{this.output.innerHTML=""});n(this,"updateMemoryUI",e=>{this.memUsedEl.textContent=String(e.used),this.memTotEl.textContent=String(e.total)});n(this,"updatePrompt",(e,t,r)=>{switch(this.cwdEl.classList.remove("cwdAuthAdmin","cwdAuthUser","cwdAuthGuest"),r){case"admin":this.cwdEl.classList.add("cwdAuthAdmin");break;case"user":this.cwdEl.classList.add("cwdAuthUser");break;case"guest":this.cwdEl.classList.add("cwdAuthGuest");break}this.cwdEl.textContent=e+(t?"#":"$")});n(this,"updateConnectionBadge",e=>{this.connBadge.textContent=e?"connected":"offline"});this.output=document.getElementById("output"),this.cwdEl=document.getElementById("cwd"),this.memUsedEl=document.getElementById("memUsed"),this.memTotEl=document.getElementById("memTot"),this.connBadge=document.getElementById("connBadge")}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}class x{constructor(){n(this,"isConnected",!1);n(this,"isCurrentlyConnected",()=>this.isConnected)}}class ee{constructor(){n(this,"db");n(this,"fs");n(this,"memory");n(this,"ui");n(this,"network");n(this,"form");n(this,"cmdInput");n(this,"delay",e=>new Promise(t=>setTimeout(t,e)));n(this,"getPromptToUpdate",()=>this.fs.getCurrentComputer().addressIp+" "+this.fs.getCurrentComputer().name+`[${this.fs.getCurrentComputer().authority.toUpperCase()}] => `+this.fs.getCurrentFolder().fullPathName);this.db=new Z,this.fs=new J,this.memory=new Q,this.ui=new Y,this.network=new x,this.form=document.getElementById("form"),this.cmdInput=document.getElementById("cmd"),this.setupEventListeners(),this.init()}setupEventListeners(){this.form.addEventListener("submit",async e=>{e.preventDefault();const t=this.cmdInput.value.trim();if(!t)return;this.ui.writePromptLine(t),this.cmdInput.value="";const r=t.split(/\s+/),s=r[0],o=r.slice(1);await this.executeCommand(s,o)}),this.cmdInput.addEventListener("keydown",e=>{if(e.key==="Tab"){e.preventDefault();const t=Object.keys(F),r=this.cmdInput.value,s=t.find(o=>o.startsWith(r));s&&(this.cmdInput.value=s+" ")}})}async executeCommand(e,t){const r=F[e];if(!r){this.ui.writeLine(`${e}: commande inconnue. Tape 'help'.`);return}try{const s={fs:this.fs,ui:this.ui,memory:this.memory,network:this.network,db:this.db,getPromptToUpdate:this.getPromptToUpdate,delay:this.delay};await r(t,s)}catch(s){console.error(s),this.ui.writeLine(`Erreur: ${(s==null?void 0:s.message)??String(s)}`)}}async init(){this.ui.writeLine("Hacknet-like terminal prototype (Vanilla TS)"),this.ui.writeLine("Tape 'help' pour commencer."),this.ui.updateMemoryUI(this.memory.getMemory()),this.ui.updatePrompt(this.getPromptToUpdate(),this.network.isCurrentlyConnected(),this.fs.getCurrentComputer().authority),await this.db.get("fs")&&this.ui.writeLine("load from db.get fs => work in progress...")}}new ee;
